<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>-->
    <script src="https://shadow.elemecdn.com/npm/vue@2.5.21/dist/vue.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
</head>
<body>
<div id="app">
    <div class="format-wrap">
        <el-upload
                action="/format"
                :on-success="handleFormatSuccess"
                :before-upload="beforeFormatUpload"
                :before-remove="beforeFormatRemove"
                :data="formatData"
                accept="text/html, application/vnd.ms-excel, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                with-credentials>
            <el-button size="medium" type="primary" alt="上传课程表excel或html文件">点击上传</el-button>
            <div style="display:inline;margin-left: 20px; padding:10px 0;">
                <img width="35" height="35" style="margin-bottom: -14px;"
                     src="http://pp.myapp.com/ma_icon/0/icon_52528981_1626526229/256"/>
                <el-link style="margin-bottom: -1px;margin-left: 2px;" alt="点击查看应用详情"
                         href="https://www.coolapk.com/apk/com.suda.yzune.wakeupschedule" target="_blank">
                    WakeUp课程表
                </el-link>
            </div>
            <div slot="tip" class="el-upload__tip" v-html="formatTips"></div>
        </el-upload>

    </div>
</div>

</body>
<script>
    new Vue({
        el: "#app",
        data() {
            return {
                formatTips: "未选择文件",
                formatData: {
                    token: this.token
                }
            };
        },
        methods: {
            handleFormatSuccess(resp, file) {
                //设置 UID对应的 href
                const a = document.createElement("a");
                a.style.marginLeft = "20px";
                if (resp.code === 0) {
                    this.tips = "格式化完成(<span style='color: red;'>10分钟后失效</span>)";
                    a.innerHTML = resp.fileName;
                    a.href = `/fileAttr/download?param=${resp.fileName}`;
                } else {
                    this.tips = `<span style='color: red;'>${resp.msg}</span>`;
                    a.innerHTML = resp.msg;
                }
                document.getElementById(file.uid).appendChild(a);
            },
            beforeFormatUpload() {
                this.tips = "格式化中...";
            },
            beforeFormatRemove(file) {
                return this.$confirm(`从列表中移除 ${file.name} 文件？`);
            }
        },
        mounted() {
            if (!this.token) {
                delete this.formatData.token;
            }
        }
    });
</script>
</html>
